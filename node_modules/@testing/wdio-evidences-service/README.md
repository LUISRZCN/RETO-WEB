## Wdio Evidences Service

WebdriverIO service that collects metadata about the tests' environment and process results that's integrated into an [Allure report](https://docs.qameta.io/allure-report/) together with the standard tests' results info.

The extra info attached to the Allure report is uploaded to [TestManager](https://globaldevtools.bbva.com/test-manager), a website where all the tests' execution results can be visualized, with their respective reports and attachments for a given application, contributing to facilitate the debug process when a test fails.

-----------------------

### 1. Installation

The present service is compatible to be integrated in any wdio-powered framework prepared to work with custom services. But, since it currently works with Allure reports only, it's mandatory to have `@wdio/allure-reporter` installed in your project in order to make it work.  

#### 1.1 Integration with Acis

If you're already using [Acis](https://globaldevtools.bbva.com/bitbucket/projects/BGT/repos/e2e-js-framework/browse) to run e2e tests, *wdio-evidences-service* is available by default and no additional steps are required:

```json
{
    "dependencies": {
        "@testing/acis-v6": "^2.1.6"
    }
}
```  

---

#### 1.2 Integration with other frameworks

If you're using a different WebdriverIO-powered e2e framework but would like to integrate `wdio-evidences-service` as a service, the best way to proceed is by defining the dependency together with `@wdio/allure-reporter` in your project's **package.json** (choose carefully if it should be installed as dependency or devDependency):

```json
{
    "dependencies": {
        "@wdio/allure-reporter": "^6.1.5",
        "@testing/wdio-evidences-service": "^2.1.6"
    }
}
```

You can simply do it by executing:

```bash
    npm install @wdio/allure-reporter @testing/wdio-evidences-service
```    

Additionally, the service needs to be added to the **services** list from your project's `wdio.conf.js` file:

```js
    services: [..., [require('@testing/wdio-evidences-service'), {}]]
```  

-----------------------

### 2. Evidences

The metadata collected can be useful to find evidences that help us know more about the context and circunstances given when a test fails. Such metadata is included into the report in the form of environment variables and attachment files.

---

#### 2.1 Environment variables

The following environment variables are always included on each report's test case:

* __session__

    Session data object which contains info about:

    - sessionId: Webdriver session id
    - testId: Cucumber scenario id
    - tags: Cucumber tags assigned to the scenario
    - scenario: Detail about the Cucumber's step being executed  

--

* __capabilities__

    The specific capabilities applied to run a Webdriver session.

    Example:
    ```js
        {
            "acceptInsecureCerts":true,
            "browserName":"chrome",
            "browserVersion":"94.0.4606.81",
            "goog:chromeOptions":{"debuggerAddress":"localhost:50844"},"networkConnectionEnabled":false,
            "pageLoadStrategy":"normal",
            "platformName":"mac os x",
            "proxy":{},
            "setWindowRect":true,
            "strictFileInteractability":false,
            "timeouts":{"implicit":0,"pageLoad":300000,"script":30000},
            ...
        }
    ```  

---

#### 2.2 Attachaments files

Attachment files are only provided when a test fails.

- **Source code:** It retrieves a text/html file when the testing environment is web or a text/xml when the testing environment is mobile native.
- **Failure screenshot:** Screenshot of the step where a given scenario fails.
- **Logs:** Complete logs generated during the testing process.

---

Did this documentation fullfilled your expectations? If you miss something, [let us know](mailto:testing.global.group@bbva.com)!