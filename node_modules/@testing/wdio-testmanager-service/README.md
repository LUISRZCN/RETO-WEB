## Wdio Testmanager Service

`wdio-testManager-service` is a WebdriverIO service conceived to inform [Galatea](https://globaldevtools.bbva.com/bitbucket/projects/BGT/repos/galatea/browse) about the state of a test execution so data about the process can be sent to [TestManager](https://globaldevtools.bbva.com/test-manager/) in real time.

Thanx to this we can have VNC video streaming of our e2e testing execution process that can be visualized in [TestManager](https://globaldevtools.bbva.com/test-manager/) while the tests' executions are in progress.

-----------------------

### 1. Installation

The service has been conceived to be integrated in any wdio-powered framework prepared to work with custom services.

---

#### 1.1 Integration with Acis

If you're already using [Acis](https://globaldevtools.bbva.com/bitbucket/projects/BGT/repos/e2e-js-framework/browse) to run e2e tests, `wdio-testmanager-service` is available by default from *version 2.1.5*, and no additional steps are required:

```json
{
    "dependencies": {
        "@testing/acis-v6": "^2.1.6"
    }
}
```  

---

#### 1.2 Integration with other frameworks

If you're using a different WebdriverIO-powered e2e framework but would like to integrate `wdio-testmanager-service` as part of your testing suite, the best way to proceed is by defining the dependency in your project's **package.json** (choose carefully if it should be installed as dependency or devDependency):

```json
{
    "dependencies": {
        "@testing/wdio-testmanager-service": "^2.1.6"
    }
}
```

You can simply do it by executing:

```bash
    npm install @testing/wdio-testmanager-service
```    

Additionally, the service needs to be added to the **services** list from your project's `wdio.conf.js` file:

```js
    services: [..., [require('@testing/wdio-testmanager-service'), {}]]
```  

-----------------------

### 2. Configuration

To get the service working successfully it's necessary to assure that the following is properly configured:

---

#### 2.1 Galatea is configured as browsers' provider

To establish Galatea as browsers provider it's as simple as defining the following environment variables before executing the tests' runner:

```groovy
    sh 'GALATEA=true GRID_TUNNEL=true GRID_USER=bot-galatea GRID_PASS=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX npm run test:e2e'
```   

--

* __GALATEA__

    The value needs to be explicitely set to truthy so we can enable Galatea as our browsers' provider.

    Type: `Boolean`  
    Default: *false* 

--

* __GRID_USER__

    The user name provided to connect with Galatea / Sauce Labs.

    Type: `String`  
    Default: *null* 

    To configure a Jenkins' bot with the required credentials to establish connection with Galatea / Sauce Labs, you can open a request via **[Testing Servicedesk.](https://globaldevtools.bbva.com/jira/servicedesk/customer/portal/15/group/38)**

    It's also possible to create credentials for individual testing purposes in this [link](https://globaldevtools.bbva.com/testing).

--

* __GRID_PASS__

    The apikey provided to connect with Galatea / Sauce Labs.

    Type: `String`  
    Default: *null* 

    To configure a Jenkins' bot with the required credentials to establish connection with Galatea / Sauce Labs, you can open a request via **[Testing Servicedesk.](https://globaldevtools.bbva.com/jira/servicedesk/customer/portal/15/group/38)**

    It's also possible to create credentials for individual testing purposes in this [link](https://globaldevtools.bbva.com/testing).

--

* __GRID_TUNNEL__

    The value needs to be set to truthy when it's necessary to open a tunnel between Galatea and the application against with the tests are running, so communication can be established between both servers. For example, when your environment is set up in a local server with no direct connection to internet.

    Type: `Boolean`  
    Default: *false* 

---

#### 2.2 Testing Workflowlib is implemented

The pipeline needs to be configured to execute your e2e tests' runner through the [Global Testing library](https://globaldevtools.bbva.com/bitbucket/projects/BGT/repos/testing-workflowlib/browse), like in the example below:

```groovy
    stage ("Integration Tests") {
        steps {
            withCredentials([
                usernamePassword(credentialsId: 'bot-galatea', usernameVariable: 'GRID_USER',passwordVariable: 'GRID_PASS'),
                file(credentialsId: 'bot-artifactory-npm', variable: 'NPM_CONFIG_USERCONFIG')
            ]) {
                withTestManager([
                    namespace: 'default',
                    application: 'global-testing-front-framework',
                    urlCredential: 'test-manager-url',
                    gridCredentials: 'bot-galatea',
                    artifactoryNpmCredentials: 'bot-artifactory-npm',
                    type: 'e2e',
                    environment: 'public'
                ]) {
                    runTests([
                        tests: [[
                            type: 'e2e',
                            framework: 'acis',
                            runner: {
                                sh "GALATEA=true GRID_TUNNEL=true npm run test:e2e"
                            },
                            results: [
                                attachments: ["packages/{*,examples/*}/results/*"],
                                pattern: "packages/{*,examples/*}/results/*-testsuite.xml"
                            ]
                        ]]
                    ])
                }
            }
        }
    }
```

---

Did this documentation fullfilled your expectations? If you miss something, [let us know](mailto:testing.global.group@bbva.com)!