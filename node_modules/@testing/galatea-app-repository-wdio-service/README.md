## Wdio Galatea App Repository Service

WebdriverIO service that allows us to upload a native application package directly to [Galatea](https://globaldevtools.bbva.com/bitbucket/projects/BGT/repos/galatea/browse) so that the application can be installed in a native device provided by Galatea for tests to be run against it.  

-----------------------

### 1. Installation

The service is compatible to be integrated in any wdio-powered framework prepared to work with [custom services](https://webdriver.io/docs/customservices).  

---

#### 1.1 Integration with Acis

If you're already using [Acis](https://globaldevtools.bbva.com/bitbucket/projects/BGT/repos/e2e-js-framework/browse) to run e2e tests, *galatea-app-repository-wdio-service* is available by default and no additional steps are required.  

Acis v6 dependency in package.json:

```json
{
    "dependencies": {
        "@testing/acis-v6": "^2.1.6"
    }
}
```  

---

#### 1.2 Integration with other frameworks

If you're using a different WebdriverIO-powered e2e framework but would like to integrate `galatea-app-repository-wdio-service` as a service, the best way to proceed is by defining the dependency in your project's **package.json**.

```json
{
    "dependencies": {
        "@testing/galatea-app-repository-wdio-service": "^2.1.6"
    }
}
```

You can simply do it by executing:

```bash
    npm install @testing/galatea-app-repository-wdio-service
```    

Additionally, the service needs to be added to the **services** list from your project's `wdio.conf.js` file:

```js
    services: [..., [require('@testing/galatea-app-repository-wdio-service')]]
```  

-----------------------

### 2. Configuration

To get the service working successfully it's necessary to assure the following is properly configured: 

---

#### 2.1 Galatea credentials are on point

To configure Galatea as browsers / mobile platforms provider it's necessary to have access credentials to execute tests in Jenkins. Such access credentials can be requested via **[Testing Servicedesk](https://globaldevtools.bbva.com/jira/servicedesk/customer/portal/15/group/38)**.

To execute tests in a local environment –the application and test environment are installed in your machine–, you can use the username and apikey from your **[testing credentials](https://globaldevtools.bbva.com/testing)**.

Once the credentials are on point, it's as simple as defining the following environment variables before executing the tests' runner:

```shell
    sh 'GALATEA=true GRID_USER=bot-username GRID_PASS=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX npm run test:e2e'
```  
 
--

* __GALATEA__

    Truthy when we want to use Galatea as browsers / mobile platforms provider.

    Type: `boolean`  
    Default: *false*  

--

* __GRID_USER__

    The user name provided to connect with Galatea.

    Type: `String`  
    Default: *null*  

--

* __GRID_PASS__

    The apikey provided to connect with Galatea.

    Type: `String`  
    Default: *null*  

--

* __GRID_TUNNEL__

    If your application lives in a local or proxied server you'll also need to set the enviroment variable **GRID_TUNNEL**=true in order to grant permission to stablish connection between your server and Galatea.  

    Type: `Boolean`  
    Default: *false*  

    Example:

    ```shell
        sh 'GALATEA=true GRID_TUNNEL=true GRID_USER=bot-username GRID_PASS=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX npm run test:e2e'
    ```

---

#### 2.2 Capabilities

For this service to work correctly, just assure that the following property is added to your [capabilities](https://developer.mozilla.org/en-US/docs/Web/WebDriver/Capabilities):

* `Required` __app__

    In order to upload an application package successfully to Galatea, it's important to somehow indicate the path where the application package (.apk for Android, .app.zip for iOs) is located within the workspace.
    
    Just set the target path via **app** or **appium:app** capability, as shown in the example below:  
    
    ```js
        exports.device = {
            platformName: "Android",
            app: join(__dirname, "../bin/AndroidWebView.apk"),
            platformVersion: "9",
            deviceName: ".*",
            autoWebview: true,
            maxInstances: 1,
            chromedriverExecutableDir: process.env.CHROME_DRIVER_DIR,
            testobject_api_key : process.env.TEST_OBJECT_API_KEY_ANDROID
        };
    ```  

---

Did this documentation fullfilled your expectations? If you miss something, [let us know](mailto:testing.global.group@bbva.com)!