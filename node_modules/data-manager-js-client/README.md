# DataManager js client

Nodejs client library for the [DataManager server](https://globaldevtools.bbva.com/bitbucket/projects/BGT/repos/data-manager/browse).

## Usage

```typescript
import {DataManager} from '../src/data-manager-js-client';

let dm = new DataManager({baseUrl: 'http://my.data-manager/'});

dm.findOne({tags:['sample']}).then((result) => {
    console.log('This is the data', result.data);
    return dm.unlock(result.id, result.lock);
});
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [DataEntry](#dataentry)
    -   [Properties](#properties)
-   [DataManager](#datamanager)
    -   [Parameters](#parameters)
    -   [lock](#lock)
        -   [Parameters](#parameters-1)
    -   [unlock](#unlock)
        -   [Parameters](#parameters-2)
    -   [unlockAndBurnData](#unlockandburndata)
        -   [Parameters](#parameters-3)
    -   [findOne](#findone)
        -   [Parameters](#parameters-4)
    -   [findMultiple](#findmultiple)
        -   [Parameters](#parameters-5)
-   [DataEntryResult](#dataentryresult)
    -   [Properties](#properties-1)
-   [MultipleDataEntryResult](#multipledataentryresult)
-   [DataManagerQuery](#datamanagerquery)
    -   [Properties](#properties-2)
-   [MultipleDataManagerQuery](#multipledatamanagerquery)
-   [DataManagerConfig](#datamanagerconfig)
    -   [Properties](#properties-3)

### DataEntry

Data entry containing data provided by the data manager

#### Properties

-   `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `lockExpiration` **([Date](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date) \| [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String))** date when the lock expires
-   `lockType` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** either 'exclusive' or 'shared'

### DataManager

Data manager client class
Will use the configuration object provided, but it will
fallback to environment variables if avail as follows:

-   baseUrl: process.env.DATAMANAGER_BASE_URL
-   headers: JSON.parse(process.env.DATAMANAGER_HEADERS)
-   timeout: process.env.DATAMANAGER_TIMEOUT
-   withCredentials: process.env.WITH_CRENDENTIALS
-   auth.username: process.env.DATAMANAGER_AUTH_USERNAME
-   auth.password: process.env.DATAMANAGER_AUTH_PASSWORD
-   maxRedirects: process.env.DATAMANAGER_MAX_REDIRECTS
-   proxy: process.env.DATAMANAGER_PROXY

#### Parameters

-   `config` **[DataManagerConfig](#datamanagerconfig)?** 

#### lock

Locks the data entry with the indicated id.

##### Parameters

-   `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `exclusive` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** if should be locked in exclusive mode
-   `attempt`   (optional, default `0`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

#### unlock

Removes the lock in the provided data entry

##### Parameters

-   `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the id of the data entry
-   `lockid` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the id of the lock

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

#### unlockAndBurnData

Removes the lock and tags in the provided data entry

##### Parameters

-   `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the id of the data entry
-   `lockid` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the id of the lock
-   `tags` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** the list of tags to burn of the data entry

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

#### findOne

Find a single data entry

##### Parameters

-   `query` **[DataManagerQuery](#datamanagerquery)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[DataEntryResult](#dataentryresult)>** 

#### findMultiple

Finds and locks multiple data entries by key

##### Parameters

-   `query` **[MultipleDataManagerQuery](#multipledatamanagerquery)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[MultipleDataEntryResult](#multipledataentryresult)>** 

### DataEntryResult

DataEntry result. Represents a reserved data entry in the data-manager.

#### Properties

-   `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `data` **any** 
-   `lock` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the id of the lock entry

### MultipleDataEntryResult

Multiple data entry result. Map containing the results per requested
key

### DataManagerQuery

Data manager query

#### Properties

-   `tags` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** tags that the data provided must fullfil
-   `lock` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** indicates if the lock over the data should be exclusive

### MultipleDataManagerQuery

Map of querys by requested key

### DataManagerConfig

Data manager config

#### Properties

-   `baseUrl` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `headers` **[Map](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** 
-   `timeout` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** in miliseconds
-   `withCredentials` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 
-   `maxRedirects` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `proxy` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** \*
